document.addEventListener('DOMContentLoaded',function(){
// Inicializar tooltips si Bootstrap está disponible
if(typeof bootstrap!=='undefined'&&bootstrap.Tooltip){
var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)})
}
// Confirmar eliminaciones
document.querySelectorAll('.btn-delete').forEach(function(btn){
btn.addEventListener('click',function(e){
if(!confirm('¿Está seguro de que desea eliminar este elemento?')){e.preventDefault()}
})
});
// Estados de carga en formularios
document.querySelectorAll('form').forEach(function(form){
form.addEventListener('submit',function(){
var submitBtn=form.querySelector('button[type="submit"]');
if(submitBtn){
submitBtn.disabled=true;
submitBtn.innerHTML='<span class="spinner-border spinner-border-sm" role="status"></span> Procesando...'
}
})
});
// Lazy loading para imágenes
if('IntersectionObserver' in window){
var imageObserver=new IntersectionObserver(function(entries,observer){
entries.forEach(function(entry){
if(entry.isIntersecting){
var img=entry.target;
img.src=img.dataset.src;
img.classList.remove('lazy');
imageObserver.unobserve(img)
}
})
});
document.querySelectorAll('img[data-src]').forEach(function(img){imageObserver.observe(img)})
}
// Optimización de tablas grandes
var tables=document.querySelectorAll('.table-responsive table');
tables.forEach(function(table){
if(table.rows.length>100){
table.classList.add('table-sm')
}
});
// Cache de formularios en localStorage
var forms=document.querySelectorAll('form[data-cache]');
forms.forEach(function(form){
var cacheKey='form_'+form.dataset.cache;
// Restaurar datos del cache
var cachedData=localStorage.getItem(cacheKey);
if(cachedData){
try{
var data=JSON.parse(cachedData);
Object.keys(data).forEach(function(key){
var input=form.querySelector('[name="'+key+'"]');
if(input&&input.type!=='password'){input.value=data[key]}
})
}catch(e){}
}
// Guardar en cache al cambiar
form.addEventListener('input',function(){
var formData={};
var inputs=form.querySelectorAll('input,select,textarea');
inputs.forEach(function(input){
if(input.name&&input.type!=='password'){formData[input.name]=input.value}
});
localStorage.setItem(cacheKey,JSON.stringify(formData))
});
// Limpiar cache al enviar
form.addEventListener('submit',function(){localStorage.removeItem(cacheKey)})
})
});